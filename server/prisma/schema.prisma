generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id          String    @id @default(uuid())
  email       String    @unique
  password    String
  name        String?
  companyName String?
  clients     Client[]
  invoices    Invoice[]
  products    Product[]
  settings    Settings?
  recurringProfiles RecurringProfile[]
}

model RecurringProfile {
  id           String    @id @default(uuid())
  userId       String
  user         User      @relation(fields: [userId], references: [id])
  clientId     String
  client       Client    @relation(fields: [clientId], references: [id])
  name         String?   // e.g. "Monthly Retainer"
  cronSchedule String    // e.g. "0 0 1 * *" (1st of every month)
  nextRun      DateTime
  lastRun      DateTime?
  status       String    @default("ACTIVE") // ACTIVE, PAUSED, COMPLETED
  items        String    // JSON string for template items
  total        Float
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model Settings {
  id          String   @id @default(uuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id])
  currency    String   @default("USD")
  taxRate     Float    @default(0)
  taxLabel    String   @default("Tax")
  logoUrl     String?
  brandColor  String   @default("#2563eb")
  invoiceNote String?  @default("Thank you for your business!")
  createdAt   DateTime @default(now())
}

model Client {
  id        String    @id @default(uuid())
  userId    String
  user      User      @relation(fields: [userId], references: [id])
  name      String
  email     String
  phone     String?
  address   String?
  vatNumber String?
  notes     String?
  invoices  Invoice[]
  recurringProfiles RecurringProfile[]
  createdAt DateTime @default(now())
}

model Product {
  id          String        @id @default(uuid())
  userId      String
  user        User          @relation(fields: [userId], references: [id])
  name        String
  description String?
  price       Float
  items       InvoiceItem[]
  createdAt   DateTime      @default(now())
}

model Invoice {
  id            String        @id @default(uuid())
  invoiceNumber String? // Auto-generated e.g. INV-001
  userId        String
  user          User          @relation(fields: [userId], references: [id])
  clientId      String
  client        Client        @relation(fields: [clientId], references: [id])
  date          DateTime      @default(now())
  dueDate       DateTime?
  status        String        @default("DRAFT") // DRAFT, SENT, PAID, OVERDUE
  items         InvoiceItem[]
  subtotal      Float         @default(0)
  taxRate       Float         @default(0)
  taxAmount     Float         @default(0)
  discount      Float         @default(0) // Fixed amount or percentage? Let's assume fixed for now
  total         Float
  notes         String?
  terms         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

model InvoiceItem {
  id          String   @id @default(uuid())
  invoiceId   String
  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  productId   String?
  product     Product? @relation(fields: [productId], references: [id])
  description String
  quantity    Float    @default(1)
  price       Float
  total       Float
}
